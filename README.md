# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

# Интернет-магазин «Web-Larёk»

«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component

Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`

#### Класс Api

Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter

Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` - хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

### Данные

В приложении используются две сущности, которые описывают данные — товар и покупатель. Они описываются с помощью TypeScript-интерфейсов:

#### Товар

```ts
interface IProduct {
  id: string; // уникальный идентификатор товара
  description: string; // описание товара
  image: string; // изображение товара
  title: string; // название товара
  category: string; // группа товара
  price: number | null; // цена товара (может быть null, если товар не продается)
}
```

#### Покупатель

```ts
interface IBuyer {
  payment: "card" | "cash"; // способ оплаты
  email: string; // электронная почта
  phone: string; // номер телефона
  address: string; // адрес доставки
}
```

### Модели данных

#### Класс ProductCatalog (каталог товаров)

Хранит все товары приложения и выбранный для подробного отображения товар.
Предоставляет методы для получения списка товаров, поиска товара по ID и работы с выбранным товаром.

Констурктор:
`constructor(events: IEvents)` - констурктор создаёт пустую модель каталога: список товаров изначально пуст, выбранный товар отсутствует. Данные заполняются только после действий пользователя или получения информации с сервера. Параметр events используется для отправки уведомлений о изменении списка товаров и выборе товара.

Поля класса:
`products: IProduct[]` - массив всех товаров каталога. Хранит товары доступные в приложении, и используется методами класса для получения или поиска товара.
`selectedProduct: IProduct | null` - выбранный товар для подробного отображения. Хранит товар, на который пользователь кликнул для просмотра деталей.
`events: IEvents` - объект для работы с событиями приложения.

Методы класса:
`saveProducts(products: IProduct[]): void` - сохраняет массив товаров, переданный в параметре, в поле products.
`getProducts(): IProduct[]` - возвращает массив всех товаров из поля products.
`getProductById(id: string): IProduct | undefined` - ищет товар по его id и возвращает его, если найден.
`saveSelectedProduct(product: IProduct): void` - сохраняет выбранный товар в поле selectedProduct.
`getSelectedProduct(): IProduct | null` - возвращает товар, выбранный для подробного отображения.

События:
`products:changed` - отправляется после обновления массива товаров (saveProducts). Передает обновленный список товаров.
`product:selected` - отправляется после выбора товара (saveSelectedProduct). Передает выбранный товар. 

#### Класс Cart (корзина)

Хранит товары, которые пользователь выбрал для покупки, и предоставляет методы для работы с этой корзиной: добавление, удаление, подсчет суммы и количества товаров, проверка наличия товара и очистка корзины.

Конструктор:
`constructor(events: IEvents)` - принимает объект брокера событий, который используется для уведомления других частей приложения об изменениях в корзине. 

Поля класса:
`items: IProduct[]` - массив товаров, которые пользователь добавил в корзину. Хранит все товары, которые в данный момент находятся корзине. Это нужно, чтобы методы могли работать с товарами.
`events: IEvents` - обхект брокера событий, через который класс генерирует уведомления о своих изменениях.

Методы класса:
`getItems(): IProduct[]` - возвращает все товары в корзине.
`addItem(product: IProduct): void` - добавляет товар в корзину.
`removeItem(product: IProduct): void` - удаляет товар из корзины.
`clear(): void` - очищает корзину, оставляяя ее пустой.
`getTotalPrice(): number` - считает и возвращает сумму всех товаров в корзине.
`getTotalCount(): number` - возвращает количество товаров в корзине.
`hasItem(id: string): boolean` - проверяет, есть ли товар с указанным id в корзине.

События:
`basket:changed` - генерируется при добавлении или удалении товара. Сообщает, что состав корзины изменился.
`basket:cleared` - генерируется при полном очищении корзины. Используется для обновления интерфейса и сброса данных.

#### Класс Customer (покупатель)

Хранит данные пользователя, необходимые для оформления заказа, и предоставляет методы для их управления: сохранение отдельных или всех полей, получение данных, очистка, валидация.

Конструктор:
`constructor(events: IEvents)` - создаёт пустой объект покупателя. На старте все поля неопределены (undefined). Данные заполняются только после действий пользователя — например, ввода информации о способе оплаты, адреса доставки, телефона или электронной почты. При инициализации необходимо передать объект событий IEvents.

Поля класса:
`events: IEvents` — объект для генерации событий.
`payment: 'card' | 'cash' | undefined` - способ оплаты.
`email: string | undefined` - электронная почта покупателя.
`phone: string | undefined` - телефон покупателя.
`address: string | undefined` - адрес доставки.

Методы класса:
`saveField(field: keyof IBuyer, value: string | 'card' | 'cash'): void` - сохраняет отдельное значение поля, не трогая остальные.
`getData(): IBuyer` - возвращает все данные покупателя.
`clear(): void` - очищает все поля покупателя.
`validate(): { [K in keyof IBuyer]?: string }` - проверяет валидность каждого поля; возвращает объект с ошибками (если поле пустое, возвращает описание ошибки).

События:
`customer:updated` - после вызова saveField передает текущие данные покупателя (IBuyer);
`customet:cleadred` - после вызовы clear информацирует о том, что все поля покупателя были очищены.

### Слой коммуникации

#### Класс Communication

Класс коммуникации отвечает за взаимодействие с сервером. Он не хранит данные, а получает их и отправляет через методы класса Api. Таким образом, он является мостом между сервером и моделями.

Конструктор:
`constructor(api: IApi)` - принимает объект, реализующий интерфейс IApi, для выполнения HTTP-запросов.

Поля класса:
`api: IApi` - хранит переданный объект Api для выполнения методов get и post.

Методы класса:
`fetchProducts(): Promise<IProduct[]>` - получает массив товаров с сервера.
`sendOrder(order: IApiOrderRequest): Promise<object>` - отправляет данные покупателя и выбраных товаров на сервер.

### Слой представления

#### Класс Header 

Данный класс отвечает за визуальную часть шапки. Отображает логотип, показывает количество товаров в корзине, реагирует на нажатие кнопки корзины. 
Наследуется от Component, поэтому получает базовые методы render() и setImage().

Конструктор:
`constructor(protected events: IEvents, container: HTMLElement)` - конструктор принимает объект для работы с событиями (events) и DOM-элемент шапки (container). Это позволяет компоненту управлять своим отображением в интерфейсе и реагировать на пользовательские действия.  

Поля класса:
`basketButton: HTMLButtonElement` - кнопка корзины (элемент на который кликает пользователь).
`counterElement: HTMLElement` - элемент, где отображается количество товаров (счетчик).

Метод класса сеттер:
`set counter(value: number)` - обновляет значение счётчика и, соответственно, отображение на экране.

Интерфейс:
У Header есть одно поле — counter. Оно отвечает за текущее значение счётчика (например, количество товаров в корзине).
```ts
interface HeaderData {
  counter: number
}
```

Событие:
`basket:toggle` - Открытие или закрытие модального окна с коризной. Срабатывает при клике на кнопку корзины в шапке (basketButton).

#### Класс Gallery  

Класс отвечает за отображение списка карточек. 
Наследуется от Component.

Конструктор:
`constructor(container: HTMLElement)` - через конструктор компонент получает ссылку на элемент, куда будут вставляться карточки.

Поля класса:
`catalogElement: HTMLElement` - контейнер для всех карточек внутри галереи.

Метод класса сеттер:
`set catalog(items: HTMLElement[])` - принимает массив карточек (HTMLElement) и вставляет их в DOM внутри catalogElement.

Интерфейс:
Описывает данные для компонента Gallery и содержит массив элементов HTMLElement, представляющих карточки товаров для отображения в галерее. 
```ts
interface GalleryData {
  catalog: HTMLElement[];
}
```

#### Класс Modal

Отвечает за отображение модального окна. Компонент усправляет вставкой произвольного контента и обработкой закрытия через кнопку. 

Конструктор:
`constructor(container: HTMLElement)`

Поля класса:
`closeButton: HTMLButtonElement` - кнопка закрытия модального окна.
`contentElement: HTMLElement` - контейнер, куда вставляется произвольный контент.

Метод класса сеттер:
`set content (element: HTMLElement | null)` - вставляет переданный элемент внутрь contentElement и обновляет содержимое модалки 
`private open()` — открывает модальное окно и блокирует прокрутку страницы.
`private close()` — закрывает модальное окно и возвращает прокрутку страницы.

Интерфейс:
Описывает даннные, передаваемые в компонент - HTML-элемент, который нужно отобразить в модальном окне.
```ts 
interface ModalData {
  content: HTMLElement | null;
}
```

#### Класс Card

Базовый класс для всех типов карточек товаров. Отвечает за отображение и обновление названия и цены. 

Конструктор:
`constructor(container: HTMLElement)`

Поля класса:
`titleElement: HTMLElement` - элемент, в котором отображается название товара
`priceElement: HTMLElement` - элемент для отображения цены.

Метод класса сеттеры:
`set data(value: CardData)` - обновляет название и цену товара в DOM.
`render(data?: Partial<CardData>): HTMLElement` - принимает частичный объект с данными title и/или price. Вызывает сеттер data для обновления элементов. Возвращает готовый DOM-элемент карточки.

Интерфейс:
Описывает структуру данных, которые карточка принимает для отображения товара.
```ts 
interface CardData {
  title: string;
  price: number | null;
}
```

#### Класс CardCatalog

Класс отвечает за отображение карточки товара в каталоге (галерее). Он наследует общий фонкционал от Card (название и цена) и добавляет собственные элементы - изображение и категорию товара.

Конструктор:
`constructor(container: HTMLElement, events: EventEmitter)` - DOM-элемент карточки и брокер событий для коммуникации с другими компонентами приложения.

Поля класса:
`imageElement: HTMLImageElement` - элемент изображения товара.
`categoryElement: HTMLElement` - элемент, отображающий категорию товара.
`addButton: HTMLButtonElement | null` — кнопка добавления/удаления товара из корзины.
`events: EventEmitter` — объект для отправки пользовательских событий наружу.

Методы класса сеттеры:
`setCategory(value: string)` - обновляет категорию товара.
`render(data: CardCatalogData): HTMLElement` — вызывает super.render(data) из базового класса и: записывает data-id и data-hasPrice в dataset, вызывает setCategory() для отображения категории, подставляет изображение товара (CDN_URL + image), автоматически заменяя .svg на .png, возвращает готовый DOM-элемент карточки.
`setInCart(value: boolean)` — задаёт состояние товара в корзине и обновляет кнопку.

Интерфейс: 
Расширяет базовый интерфейс CardData, добавляя поля image и category, необходимые для отображения карточки в галерее. 
```ts
interface CardCatalogData {
  id: string;   
  image: string;
  category: string;
}
```

События:
`cart:add { id: string }` - добавление товара в корзину;
`cart:remove	{ id: string }`	- удаление товара из корзины;
`product:selected	{ id: string }` - открытие карточки товара для просмотра.

#### Класс CardPreview

Класс отвечает за отображение подробной карточки товара (в модальном окне). Наследуется от родителя Card, который сожержит общие элементы: titleElement, priceElement. Добавляет свои элементы и функционал, уникальные для превью карточки. 

Конструктор:
`constructor(container: HTMLElement)` - принимает контейнер DOM для карточки.

Поля класса:
`imageElement: HTMLImageElement` - изображение товара.
`categoryElement: HTMLElement` - категория товара.
`descriptionElement: HTMLElement` - описание товара.
`addButton: HTMLButtonElement` - кнопка добавления товара в корзину.

Методы класса сеттеры: 
`setCategory(value: string)` — обновляет отображаемую категорию и CSS-класс.
`setDescription(value: string)` — обновляет описание товара.
`setAddButtonEnabled(enabled: boolean)` — включает или отключает кнопку добавления товара.
`render(data: CardPreviewData, actions?: { onAddToCart?: () => void; onSelect?: () => void;}): HTMLElement` - Рендерит карточку на основе переданных данных data. Устанавливает категорию и описание. Привязывает события клика к кнопке и карточке. Возвращает готовый DOM-элемент карточки.

Интерфейс:
Расширяет базовый интерфейс CardData, добавляя поля image, category и description необходимые для отображения карточки в галерее.
```ts
interface CardPreviewData {
  image: string;
  category: string;
  description: string;
}
```

#### Класс CardBasket

Класс отвечает за отображение компактной карточки товара в корзине и добавляет уникальные элементы, связанные с корзиной, например, кнопку удаления и индекс товара.

Конструктор:
`constructor(container: HTMLElement, events: IEvents)` - принимает контейнер DOM для карточки и объект для работы с событиями (например, клик по кнопке удаления). 

Поля класса:
`events: IEvents;` - сообщает действие пользователя.
`indexElement: HTMLElement` - отображает порядковый номер товара в корзине.
`deleteButton: HTMLButtonElement` - кнопка удаления товара из корзины.

Методы класса сеттеры:
`set index(value: number)` - обновляет отображаемый номер товара.
`render(data: CardBasketData): HTMLElement` - вызывает базовый метод render() из Card, затем устанавливает индекс (setIndex(data.index)),сохраняет id товара в dataset.productId для последующего удаления и возвращает DOM-элемент карточки.

Интерфейс:
```ts
interface CardBasketData {
  product: IProduct;
  index: number;
}
```

Событие:
`cart:remove` — эмитируется при клике по кнопке удаления. Передаёт объект { id: string }, где id — идентификатор товара для удаления из корзины.

#### Класс Form 

Базовый класс для работы с формами. Отвечает за хранение ссылок на поля формы, кнопку отправки и элемент для ошибок, а также за базовую логику работы с ними. 

Конструктор:
`constructor(container: HTMLFormElement)` - принимает DOM-элемент формы, чтобы работать с ее полями и кнопками. 

Поля класса
`submitButton: HTMLButtonElement` - кнопка отправки формы.
`errorElement: HTMLElement` - элемент для отображения ошибок.
`inputs: HTMLInputElement[]` - коллекция input-полей формы.

Методы класса:
`setSubmitEnabled(enabled: boolean)` - включает или отключает кнопку отправки.
`setError(message: string)` - выводит сообщение об ошибке.

Интерфейс:
Объект с данными формы, ключи - имена полей (name), значения - введенный текст.
```ts
interface FormData {
  [key: string]: string;
}
```

#### Класс OrderForm 

Класс отвечает за работу с формой оформления заказа и наследуется от базового класса Form.

Конструктор:
`constructor(container: HTMLFormElement, events: IEvents)` - принимает DOM-элемент формы для работы с ее полями и кнопкой отправки.

Поля класса:
`paymentButtons: HTMLButtonElement[]` - кнопки выбора способо оплаты (card и cash).
`addressInput: HTMLInputElement` - поле ввода адреса доставки.
`events: IEvents` — объект событий.

Методы класса сеттеры и утилиты:
`setErrors(errors: { payment?: string; address?: string })` — отображает сообщение об ошибке и включает/отключает кнопку отправки.
`render(data: OrderFormData)` - обновляет интерфейс формы и активные кнопки

Интерфейс:
```ts
interface OrderFormData {
  [key: string]: string;
  payment: "card" | "cash" | "";
  address: string;
}
```

Событие:
`order:paymentChange` — срабатывает при выборе способа оплаты; передаёт объект { payment: "card" | "cash" } с выбранным способом.
`order:addressChange` — срабатывает при изменении текста в поле адреса доставки; передаёт объект { address: string } с текущим значением адреса.
`order:submit` — срабатывает при нажатии кнопки отправки формы оформления заказа; уведомляет презентер о готовности данных для дальнейшей обработки.

#### Класс ContactsForm 

Класс отвечает за работу с формой контактов (Email и телефон) и наследуется от базового класса Form.

Конструктор:
`constructor(container: HTMLFormElement, events: IEvents)` - ринимает DOM-элемент формы и объект для работы с событиями.

Поля класса:
`emailInput: HTMLInputElement` - поле ввода Email.
`phoneInput: HTMLInputElement` - поле вводу телефона.
`events: IEvents` - объект брокера событий.

Методы класса сеттеры и утилиты:
`setErrors(errors: { email?: string; phone?: string })` — отображает сообщение об ошибке и включает/отключает кнопку отправки.
`render(data: ContactsFormData)` — обновляет значения полей формы согласно переданным данным, сбрасывает ошибки и отключает кнопку отправки.

Интерфейс:
```ts
interface ContactsFormData {
  [key: string]: string;
  email: string;
  phone: string;
}
```

Событие:
`contacts:emailChange` — вызывается при изменении поля email.
`contacts:phoneChange` — вызывается при изменении поля телефона.
`contacts:submit` — вызывается при отправке формы с текущими значениями email и телефона.

#### Класс Basket

Компонент отвечает за отображение содержимого корзины, подсчёт общей суммы и управление кнопкой оформления заказа.

Конструктор:
`constructor(container: HTMLElement, events: IEvents)` - принимает контейнер DOM, куда будет вставляться корзина + объект брокера событий.

Поля класса:
`listElement: HTMLElement` - контейнер, куда добавляются товары.
`totalPriceElement: HTMLElement` - элемент, отображающий общую сумму товаров.
`checkoutButton: HTMLButtonElement` - кнопка оформления заказа.
`events: IEvents` — событийный менеджер (для отправки событий на уровень презентера).

Методы класса сеттеры и утилиты:
`setItems(items: HTMLElement[])` — очищает список корзины и вставляет переданные карточки товаров.
Если список пуст, отображает сообщение «Корзина пуста» и отключает кнопку оформления.
`private showEmpty()` - создаёт и отображает элемент с текстом «Корзина пуста».
`setTotalPrice(value: number)` - обновляет отображение общей стоимости товаров (в синапсах).
`setCheckoutEnabled(enabled: boolean)` — активирует или деактивирует кнопку оформления заказа.
`render(data: BasketData): HTMLElement` - принимает объект с элементами корзины и суммой, вызывает setItems() и setTotalPrice(), возвращает DOM-элемент контейнера.

Интерфейс:
```ts
interface BasketData {
  items: HTMLElement[];
  totalPrice: number;
}
```

События
basket:checkout — генерируется при клике на кнопку оформления заказа.

#### Класс Success

Класс отвечает за отображение сообщения об успешном оформлении заказа в модальном окне.

Конструктор:
`constructor(container: HTMLElement, events: IEvents)` - принимает контейнер DOM, куда будет вставляться сообщение.

Поля класса:
`titleElement: HTMLElement` - заголовок сообщения
`descriptionElement: HTMLElement` - текст с деталями (например, списано синапсов).
`closeButton: HTMLButtonElement` - кнопка закрытия уведомления.
`events: IEvents` — хранит объект брокера событий, чтобы класс мог уведомлять остальное приложение о действиях пользователя.

Методы класса сеттеры:
`render(data: SuccessData)` — принимает объект с суммой заказа и формирует текст сообщения.

Интерфейс:
```ts
interface SuccessData {
  total: number;
}
```

Событие: 
`success: close` - генерируется при клике на кнопку закрытия уведомления. 

### Слой Презентер
Презентер - это слой, который отвечает за обработку событий и связывает моедли данных с представлениями. В данном приложении презентер реализован не в отдельном классе, а непосредственно в main.ts. 

-Презентер не генерирует события, он только их обрабатывает.
-Все изменения данных происходят через модели, которые сами генерируют события о своих изменениях.
-Презентер реагирует на события от моделей и представлений, вызывая соответствующие методы для обновления интерфейса.

События, которые обрабатывает презентер:
`products:changed` → обновление каталога;
`basket:changed` → обновление корзины и счетчика;
`product:selected` → открытие модального окна с карточкой товара;
`order:submit` → переход к форме контактов;
`contacts:submit` → завершение заказа.